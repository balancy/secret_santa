{% extends 'games/base.html' %}
{% load static %}
{% block header %}
  <title>Изменение игры</title>
{% endblock %}

{% block content %}
  <div class="card">
    <div class="card-header">
      Изменение игры
    </div>
    <div class="card-body">
      <form method="post">
        {% csrf_token %}
        {% for err in form.non_field_errors %}
          <p class="red">{{ err }}</p>
        {% endfor %}

        {% for field in form %}
          <div class="row">

            {% if field.name == 'name' %}

              <div class="col my-2 col-6">
                {{ field.label_tag }}
              </div>
              <div class="col my-2 col-6">
                {{ field }}
              </div>
              <span class="red">{{ field.errors }}</span>

              <div class="col-6 my-2">
                Ограничить стоимость подарка
              </div>

              <div class="col-2 my-2">
                <label class="switch">
                  <input
                    type="checkbox"
                    onclick="togglePriceElement()"
                    {% if form.instance.max_price is not None %}checked{% endif %}
                  >
                  <span class="slider round"></span>
                </label>
              </div>
              <div class="col-4 my-2"></div>

            {% elif field.name == 'max_price' %}
              <div
                class="col col-12"
                id="can_hide"
                style="display: {% if form.instance.max_price is None %}none{% else %}initial{% endif %};"
              >
                <div class="row">
                  <div class="col can_hide my-2 col-6">
                    {{ field.label_tag }}
                  </div>
                  <div class="col cah_hide my-2 col-6">
                    {{ field }}
                  </div>
                </div>
              </div>

            {% else %}
              <div class="col my-2 col-6">
                {{ field.label_tag }}
              </div>
              <div class="col my-2 col-6">
                {{ field }}
              </div>
              <span class="red">{{ field.errors }}</span>
            {% endif %}
          </div>

        {% endfor %}

        <button class="btn btn-outline-dark my-3 float-right" type="submit">
          Изменить данные
        </button>
      </form>
    </div>
    <hr>
    <div class="card-body">
      <p class="mb-3">Участники:</p>
      {% for santa in santas %}
        <div class="row">
          <div class="col-3">
            {{ forloop.counter }}. {{ santa.user.username }}
          </div>
          <div class="col-3">
            <a href="#" class="text-danger">удалить</a>
          </div>
        </div>
      {% endfor %}
    </div>
  </div>

<script>
  const togglePriceElement = () => {
      el = document.getElementById('can_hide');
      if (el.style.display === 'none') {
        el.style.display = 'initial';
      } else {
        el.style.display = 'none';
        document.getElementById('max_price').value = null;
      }
  }
</script>

{% endblock %}